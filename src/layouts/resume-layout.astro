---
import type { CVData } from '../utils/schemas/cv-schema';
import ThemeSwitcher from '../components/ui/theme-switcher.astro';
import SocialShare from '../components/ui/social-share.astro';
import ExportButton from '../components/ui/export-button.astro';

interface Props {
  title: string;
  description?: string;
  theme?: 'professional' | 'modern' | 'creative' | 'minimal';
  cvData?: CVData;
}

const {
  title,
  description = 'Professional CV Website',
  theme = 'professional',
  cvData,
} = Astro.props;

const structuredData = cvData
  ? {
      '@context': 'https://schema.org',
      '@type': 'Person',
      name: cvData.basics.name,
      jobTitle: cvData.basics.label,
      email: cvData.basics.email,
      telephone: cvData.basics.phone,
      url: cvData.basics.url,
      address: cvData.basics.location
        ? {
            '@type': 'PostalAddress',
            addressLocality: cvData.basics.location.city,
            addressCountry: cvData.basics.location.country_code,
          }
        : undefined,
    }
  : null;
---

<!doctype html>
<html lang="en" data-theme={theme}>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="author" content={cvData?.basics.name} />

    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta
      property="og:image"
      content={cvData?.basics.image || '/og-image.jpg'}
    />

    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={Astro.url} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta
      property="twitter:image"
      content={cvData?.basics.image || '/og-image.jpg'}
    />

    <meta name="robots" content="index, follow" />
    <link rel="canonical" href={Astro.url} />

    {
      structuredData && (
        <script
          type="application/ld+json"
          is:inline
          set:html={JSON.stringify(structuredData)}
        />
      )
    }

    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      as="style"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/src/styles/animations.css" />

    <style>
      @import '/src/styles/globals.css';
    </style>
  </head>
  <body>
    <ThemeSwitcher />

    <ExportButton />

    <SocialShare
      title={title}
      url={Astro.url.toString()}
      description={description}
    />

    <main
      class="cv-container max-w-letter mx-auto md:my-8 px-8 pb-2 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 shadow-lg rounded-lg min-h-letter print:max-w-none print:mx-0 print:my-0 print:px-0 print:py-0 print:shadow-none print:rounded-none md:rounded"
    >
      <slot />
    </main>

    <script>
      import { themeManager } from '../utils/theme-manager';

      document.addEventListener('DOMContentLoaded', () => {
        themeManager.init();
      });
    </script>
  </body>
</html>
